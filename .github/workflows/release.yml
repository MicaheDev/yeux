name: 'Build and Release'

on:
  # 游댃 CAMBIO CLAVE: Dispara el workflow con cada push a la rama 'main' (para pruebas)
  push:
    branches:
      - master
  # Tambi칠n se disparar치 cuando hagas un push de una etiqueta que comience con 'v' (para releases oficiales)
    tags:
      - 'v*'

jobs:
  build-macos:
    # 游꿢 M치quina Mac para compilar el bundle nativo
    runs-on: macos-latest
    
    strategy:
      matrix:
        node-version: [20.x]
        
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 游닍 Instalar Bun (necesario si Bun no est치 en el PATH por defecto)
      - name: Install bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Install Rust Toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: stable
      
      - name: Install Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      - name: Install Dependencies (using bun)
        # Esto instala tus dependencias de frontend
        run: bun install
        
      # 游 El paso de compilaci칩n que usa la m치quina Mac
      - name: Build macOS App
        uses: tauri-apps/tauri-action@v0
        with:
          # --target universal-apple-darwin genera un binario que funciona 
          # tanto en Macs Intel como Apple Silicon (M1/M2/M3).
          args: --target universal-apple-darwin
          
      # 游닋 Cargar los archivos .app y .dmg compilados como un artefacto
      - name: Upload macOS Artifacts (App Bundle and DMG)
        uses: actions/upload-artifact@v4
        with:
          name: Yeux-macos-app-and-dmg
          # Ruta donde Tauri guarda los bundles compilados para el target universal:
          path: src-tauri/target/universal-apple-darwin/release/bundle
